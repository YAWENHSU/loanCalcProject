<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>貸款利息計算器</title>
    <!--<link rel="stylesheet" href="style.css">-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        input {
            text-align: center;
        }
    </style>
</head>

<body>
    <section class="hero is-info is-fullheight">
        <div class="hero-body">
            <div class="container has-text-centered">
                <p class="title is-size-2">
                    貸款利息計算器
                </p>

                <div class="columns is-centered">
                    <div class="column is-8">
                        <form class="box has-background-warning">

                            <div class="field box has-background-link has-text-light">
                                <label class="label is-size-3 has-text-light">計算方式</label>
                                <div class="control">
                                    <input type="radio" id="principalPayment" name="repayment" checked>本金攤還
                                    <input type="radio" id="interestPayment" name="repayment">本息攤還
                                </div>

                            </div>
                            <div class="field m-6 ">
                                <label class="label is-size-5" for="loanAmount">貸款金額(萬)</label>
                                <input class="input is-size-6 " type="number" id="loanAmount" placeholder="請輸入金額"
                                    value="10">
                            </div>
                            <div class="field m-6 ">
                                <label class="label is-size-5" for="interestRate">貸款利率(%)</label>
                                <input class="input is-size-6" type="number" id="interestRate" step="0.1" value="3.5">
                            </div>
                            <div class="field m-6 ">
                                <label class="label is-size-5" for="loanYear">貸款年數(年)</label>
                                <select class="select  is-fullwidth has-text-centered is-size-6" name="loanYear"
                                    id="loanYear">
                                    <option value="3">3</option>
                                    <option value="5">5</option>
                                    <option value="7" selected>7</option>
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                </select>
                            </div>
                            <input class="button has-background-primary has-text-light" type="button" value="計算"
                                onclick="roanCalc()">
                            <input class="button has-background-danger has-text-light" type="reset" value="重置">
                        </form>

                    </div>
                </div>

                <div id="result" class="box is-size-4 has-background-primary-light has-text-primary-dark"></div>

                <div class="columns is-centered">
                    <div class="column is-10">
                        <table id="resultTable" class="table is-fullwidth is-bordered is-striped is-hoverable " hidden>
                            <thead class="has-background-link">
                                <tr>
                                    <th class="has-text-centered has-text-white">期別</th>
                                    <th class="has-text-centered has-text-white">本金</th>
                                    <th class="has-text-centered has-text-white">利息</th>
                                    <th class="has-text-centered has-text-white">本利和</th>
                                    <th class="has-text-centered has-text-white">餘額</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>

                <a href="" class="button has-background-primary has-text-light">TOP</a>

            </div>



        </div>
    </section>


    <script>
        const loanAmountEl = document.querySelector("#loanAmount");
        const interestRateEl = document.querySelector("#interestRate");
        const loanYearEl = document.querySelector("#loanYear");
        const principalPaymentEl = document.querySelector("#principalPayment");
        const resultEl = document.querySelector("#result");
        const tableTbodyEl = document.querySelector("#resultTable>tbody");



        function roanCalc() {
            //取得貸款金額/利率/年期
            let loanAmount = loanAmountEl.value * 10000;
            let interestRate = interestRateEl.value;
            let loanYear = loanYearEl.value;
            //本金攤還方式
            let principalPayment = principalPaymentEl.checked;
            console.log(loanAmount, interestRate, loanYear, principalPayment);

            let amount = loanAmount;
            let months = loanYear * 12;
            let monthRate = interestRate / 100 / 12;


            //固定還款金額
            let monthPay = parseInt(amount / months);

            let resultPayment = [];

            console.log(amount, months, monthRate, monthPay);
            //跑動期數
            for (let i = 0; i < months; i++) {
                //計算每個月利息
                let interest = Math.round(amount * monthRate)
                //減少餘額
                amount -= monthPay;
                //最後一期
                let text = "";
                if (i == months - 1) {
                    resultPayment.push([i + 1, monthPay + amount, interest, monthPay + interest + amount, 0]);

                }
                else {
                    resultPayment.push([i + 1, monthPay, interest, monthPay + interest, amount]);
                }

            }

            //計算期數、總利息、還款總金額
            let totalInterest = 0;
            for (let i = 0; i < resultPayment.length; i++) {
                totalInterest += resultPayment[i][2];
            }


            resultEl.innerHTML = `期數:${resultPayment.length}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;總利息:${totalInterest}
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;還款總金額:${loanAmount + totalInterest}`;


            drawTable(resultPayment)
        }

        //繪製表格
        function drawTable(resultPayment) {
            //console.log(tableTbodyEl, resultPayment);
            let tableHtml = "";
            for (let i = 0; i < resultPayment.length; i++) {
                tableHtml += "<tr>";
                for (let j = 0; j < resultPayment[i].length; j++) {
                    //td
                    tableHtml += `<td>${resultPayment[i][j]}</td>`;
                }
                tableHtml += "</tr>";
            }
            if (tableHtml != "") {
                document.querySelector("#resultTable").style.display = "table";
            }
            tableTbodyEl.innerHTML = tableHtml;

        }

    </script>
</body>

</html>